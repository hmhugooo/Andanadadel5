<!doctype html> 
<html lang="es"> 
<head> 
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
  <title>Acceso — Andanada del 5</title> 
  <meta name="robots" content="noindex" /> 
  <style> 
    body{ 
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; 
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; 
      background:#0b0b0b; color:#fff; 
    } 
    .card{ 
      width:min(520px,92vw); 
      background:rgba(255,255,255,.06); 
      border:1px solid rgba(255,255,255,.12); 
      border-radius:16px; 
      padding:22px 18px; 
      text-align:center; 
    } 
    .muted{opacity:.7; font-size:13px; letter-spacing:.06em; text-transform:uppercase} 
    .big{margin:10px 0 0; font-size:18px} 
  </style> 
</head> 
<body> 
  <div class="card"> 
    <div class="muted">Andanada del 5</div> 
    <div class="big">Abriendo acceso seguro…</div> 
    <p style="opacity:.75; margin:14px 0 0">Si no se abre nada, espera 2–3 segundos.</p> 
  </div> 

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> 
  <script> 
    (function () { 
      function getTokenFromUrl() { 
        // Netlify suele devolver tokens en el hash (#invite_token=... o #recovery_token=...) 
        var h = window.location.hash || ""; 
        var q = window.location.search || ""; 
        return (h + "&" + q).toLowerCase(); 
      } 

      function hasInviteOrRecovery() { 
        var all = getTokenFromUrl(); 
        return all.includes("invite_token=") || all.includes("recovery_token=") || all.includes("confirmation_token="); 
      } 

      function openIdentity() { 
        if (!window.netlifyIdentity) return; 
        window.netlifyIdentity.init(); 

        // Si hay token, abrir modal directamente 
        if (hasInviteOrRecovery()) { 
          window.netlifyIdentity.open(); 
        } else { 
          // Si alguien entra sin token, igual dejamos abrir login manual 
          window.netlifyIdentity.open("login"); 
        } 

        window.netlifyIdentity.on("login", function () { 
          document.location.href = "/admin/"; 
        }); 
      } 

      // esperar a que cargue el widget 
      var tries = 0; 
      (function wait() { 
        tries++; 
        if (window.netlifyIdentity) return openIdentity(); 
        if (tries < 80) return setTimeout(wait, 50); 
        // fallback si algo raro 
        document.location.href = "/admin/"; 
      })(); 
    })(); 
  </script> 
</body> 
</html>